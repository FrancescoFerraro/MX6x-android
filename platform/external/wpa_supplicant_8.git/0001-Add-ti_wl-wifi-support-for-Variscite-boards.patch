From ac9516c957e82a3f606a85d59cf63c1272dbe504 Mon Sep 17 00:00:00 2001
From: Eran Matityahu <eran.m@variscite.com>
Date: Thu, 13 Oct 2016 12:56:04 +0300
Subject: [PATCH] Add ti_wl wifi support for Variscite boards

---
 hostapd/Android.mk        | 11 ++++++++++-
 wpa_supplicant/Android.mk | 16 ++++++++++++++--
 2 files changed, 24 insertions(+), 3 deletions(-)

diff --git a/hostapd/Android.mk b/hostapd/Android.mk
index 4a581f5..7d6597b 100644
--- a/hostapd/Android.mk
+++ b/hostapd/Android.mk
@@ -901,6 +901,11 @@ else
 OBJS_c += src/utils/edit_simple.c
 endif
 
+ifeq ($(BOARD_WLAN_DEVICE),$(filter $(BOARD_WLAN_DEVICE), wl12xx_mac80211))
+# fix p2p mode for ti wl module
+L_CFLAGS += -DANDROID_LIB_STUB
+endif
+
 ########################
 
 include $(CLEAR_VARS)
@@ -913,13 +918,17 @@ LOCAL_C_INCLUDES := $(INCLUDES)
 include $(BUILD_EXECUTABLE)
 
 ########################
+
 include $(CLEAR_VARS)
 LOCAL_MODULE := hostapd
 LOCAL_MODULE_TAGS := optional
 ifdef CONFIG_DRIVER_CUSTOM
 LOCAL_STATIC_LIBRARIES := libCustomWifi
 endif
-LOCAL_STATIC_LIBRARIES += lib_driver_cmd_bcmdhd
+ifneq ($(BOARD_HOSTAPD_PRIVATE_LIB),)
+LOCAL_STATIC_LIBRARIES += $(BOARD_HOSTAPD_PRIVATE_LIB)
+endif
+LOCAL_STATIC_LIBRARIES += lib_driver_cmd_wl12xx
 LOCAL_SHARED_LIBRARIES := libc libcutils liblog libcrypto libssl
 ifdef CONFIG_DRIVER_NL80211
 ifneq ($(wildcard external/libnl),)
diff --git a/wpa_supplicant/Android.mk b/wpa_supplicant/Android.mk
index d440dd6..b80bc47 100644
--- a/wpa_supplicant/Android.mk
+++ b/wpa_supplicant/Android.mk
@@ -26,7 +26,14 @@ L_CFLAGS += -DANDROID_LOG_NAME=\"wpa_supplicant\"
 L_CFLAGS += -Wno-unused-parameter
 
 # Set Android extended P2P functionality
+ifeq ($(BOARD_WLAN_DEVICE),$(filter $(BOARD_WLAN_DEVICE), qcwcn UNITE wl12xx_mac80211))
 L_CFLAGS += -DANDROID_P2P
+endif
+
+ifeq ($(BOARD_WLAN_DEVICE),$(filter $(BOARD_WLAN_DEVICE), wl12xx_mac80211))
+# fix p2p mode for ti wl module
+L_CFLAGS += -DANDROID_LIB_STUB
+endif
 
 # Disable roaming in wpa_supplicant
 ifdef CONFIG_NO_ROAMING
@@ -1545,15 +1552,21 @@ LOCAL_C_INCLUDES := $(INCLUDES)
 include $(BUILD_EXECUTABLE)
 
 ########################
+
 include $(CLEAR_VARS)
 LOCAL_MODULE := wpa_supplicant
 ifdef CONFIG_DRIVER_CUSTOM
 LOCAL_STATIC_LIBRARIES := libCustomWifi
 endif
-LOCAL_STATIC_LIBRARIES += lib_driver_cmd_bcmdhd
+ifneq ($(BOARD_WPA_SUPPLICANT_PRIVATE_LIB),)
+LOCAL_STATIC_LIBRARIES += $(BOARD_WPA_SUPPLICANT_PRIVATE_LIB)
+endif
+LOCAL_STATIC_LIBRARIES += lib_driver_cmd_wl12xx
 ifneq ($(BOARD_WPA_SUPPLICANT_PRIVATE_LIB_BCM),)
 LOCAL_STATIC_LIBRARIES += $(BOARD_WPA_SUPPLICANT_PRIVATE_LIB_BCM)
 endif
+LOCAL_CFLAGS += -DFSL_WIFI_VENDOR
+LOCAL_CFLAGS += -DBROADCOM_WIFI_VENDOR
 LOCAL_SHARED_LIBRARIES := libc libcutils liblog
 ifdef CONFIG_EAP_PROXY
 LOCAL_STATIC_LIBRARIES += $(LIB_STATIC_EAP_PROXY)
@@ -1577,7 +1590,6 @@ LOCAL_STATIC_LIBRARIES += libnl_2
 endif
 endif
 LOCAL_CFLAGS := $(L_CFLAGS)
-LOCAL_CFLAGS += -DBROADCOM_WIFI_VENDOR
 LOCAL_SRC_FILES := $(OBJS)
 LOCAL_C_INCLUDES := $(INCLUDES)
 include $(BUILD_EXECUTABLE)
-- 
2.10.1

