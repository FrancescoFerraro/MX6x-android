From 5607b9c2984a791391ea6ab244d059480fc8a45b Mon Sep 17 00:00:00 2001
From: Harshesh Valera <harshesh.v@variscite.com>
Date: Tue, 24 Apr 2018 12:31:23 -0700
Subject: [PATCH 1/2] Bluetooth: fix for TI ST kim bluetooth HAL

Change-Id: I0028d76df2c0c97f3fda878ca5cf0fb03677f53b
Signed-off-by: Harshesh Valera <harshesh.v@variscite.com>
---
 bluetooth/1.0/default/Android.mk                               |  2 ++
 .../1.0/default/android.hardware.bluetooth@1.0-service.rc      | 10 ++++++++++
 bluetooth/Android.bp                                           |  1 -
 3 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/bluetooth/1.0/default/Android.mk b/bluetooth/1.0/default/Android.mk
index 38294c7..67baa4e 100644
--- a/bluetooth/1.0/default/Android.mk
+++ b/bluetooth/1.0/default/Android.mk
@@ -13,6 +13,7 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
+ifneq ($(USE_VAR_HACKED_HIDL), true)
 LOCAL_PATH:= $(call my-dir)
 
 include $(CLEAR_VARS)
@@ -37,3 +38,4 @@ LOCAL_SHARED_LIBRARIES += \
   android.hardware.bluetooth@1.0 \
 
 include $(BUILD_EXECUTABLE)
+endif
diff --git a/bluetooth/1.0/default/android.hardware.bluetooth@1.0-service.rc b/bluetooth/1.0/default/android.hardware.bluetooth@1.0-service.rc
index 47cc13e..2a5d3a3 100644
--- a/bluetooth/1.0/default/android.hardware.bluetooth@1.0-service.rc
+++ b/bluetooth/1.0/default/android.hardware.bluetooth@1.0-service.rc
@@ -12,3 +12,13 @@ on property:vts.native_server.on=0 && property:ro.build.type=userdebug
     start bluetooth-1-0
 on property:vts.native_server.on=0 && property:ro.build.type=eng
     start bluetooth-1-0
+
+on property:vts.native_server.on=0 && property:ro.build.type=eng
+    start uim
+on property:vts.native_server.on=0 && property:ro.build.type=userdebug
+    start uim
+
+on property:vts.native_server.on=1 && property:ro.build.type=userdebug
+    stop uim
+on property:vts.native_server.on=1 && property:ro.build.type=eng
+    stop uim
diff --git a/bluetooth/Android.bp b/bluetooth/Android.bp
index ed19a37..33f70eb 100644
--- a/bluetooth/Android.bp
+++ b/bluetooth/Android.bp
@@ -1,6 +1,5 @@
 // This is an autogenerated file, do not edit.
 subdirs = [
     "1.0",
-    "1.0/default",
     "1.0/vts/functional",
 ]
-- 
2.7.4

