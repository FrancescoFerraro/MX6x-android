From 118fd01a5b25fec3519d265de1fbfad9e1c3a1e1 Mon Sep 17 00:00:00 2001
From: Leonid Segal <leonid.s@variscite.com>
Date: Wed, 9 Mar 2016 18:41:39 +0200
Subject: [PATCH 32/34] Support for Micrel Phy Revision 1561 added

---
 drivers/net/phy/micrel.c | 18 ++++++++++++++++--
 1 file changed, 16 insertions(+), 2 deletions(-)
 mode change 100644 => 100755 drivers/net/phy/micrel.c

diff --git a/drivers/net/phy/micrel.c b/drivers/net/phy/micrel.c
old mode 100644
new mode 100755
index 2e7d453..a303f78
--- a/drivers/net/phy/micrel.c
+++ b/drivers/net/phy/micrel.c
@@ -162,6 +162,18 @@ static int ksz8021_config_init(struct phy_device *phydev)
 	return rc < 0 ? rc : 0;
 }
 
+static int ksz8081_config_init(struct phy_device *phydev)
+{
+	int regval;
+	phy_write(phydev, MII_KSZPHY_OMSO, KSZPHY_OMSO_B_CAST_OFF | KSZPHY_OMSO_RMII_OVERRIDE);
+			
+	regval = phy_read(phydev, MII_KSZPHY_CTRL);
+	regval |= KSZ8051_RMII_50MHZ_CLK | (1<<4);
+	phy_write(phydev, MII_KSZPHY_CTRL, regval);
+	
+	return 0;
+}
+
 static int ks8051_config_init(struct phy_device *phydev)
 {
 	int rc;
@@ -287,7 +299,9 @@ static int ksz8081_resume(struct phy_device *phydev)
 	if (value < 0)
 		return value;
 	mutex_unlock(&phydev->lock);
-
+	
+	ksz8081_config_init(phydev);
+	
 	return 0;
 }
 
@@ -401,7 +415,7 @@ static struct phy_driver ksphy_driver[] = {
 	.phy_id_mask	= 0x00fffff0,
 	.features	= (PHY_BASIC_FEATURES | SUPPORTED_Pause),
 	.flags		= PHY_HAS_MAGICANEG | PHY_HAS_INTERRUPT,
-	.config_init	= kszphy_config_init,
+	.config_init	= ksz8081_config_init,
 	.config_aneg	= genphy_config_aneg,
 	.read_status	= genphy_read_status,
 	.ack_interrupt	= kszphy_ack_interrupt,
-- 
2.1.4

